(()=>{"use strict";function e(e,t){let s=null,i=null;const l=document.elementFromPoint(e,t);return l.classList.contains("container")?(s=e>300&&e<350?l.children[1].querySelector(".items"):l.children[2].querySelector(".items"),i=s.lastElementChild):l.classList.contains("column")?(s=l.querySelector(".items"),i=s.lastElementChild):l.classList.contains("header")?(s=l.closest(".column").querySelector(".items"),i=s.firstElementChild):l.classList.contains("items")?(s=l,i=s.lastElementChild):l.classList.contains("items-item")?(i=l,s=l.closest(".items")):(s=l.closest(".items"),i=l.closest(".items-item")),{parent:s,child:i}}const t=new class{constructor(){this.btn=document.querySelector(".btn"),this.itemsAll=document.querySelectorAll(".items"),this.cols=document.querySelectorAll(".column"),this.input=document.querySelector(".input"),this.close=document.querySelector(".close"),this.taskAll=document.querySelectorAll(".items-item"),this.container=document.querySelector(".container"),this.select=document.querySelector(".select")}createTask(e,t){const s=document.createElement("li"),i=document.createElement("span");return i.classList.add("close"),i.classList.add("hidden"),s.classList.add("items-item"),s.textContent=e,s.append(i),this.cols.forEach((e=>{e.querySelector(".header").textContent===t&&e.querySelector(".items").append(s)})),s}getTasksListObjFromDom(){const e={};return this.itemsAll.forEach((t=>{const s=[...t.children],i=t.closest(".column").children[0].innerText;e[i]=[],s.forEach((t=>{e[i].push(t.innerText)}))})),e}tasksListFromLS(){if(!localStorage.dragNdrops)return;const e=JSON.parse(localStorage.dragNdrops);for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&this.cols.forEach((s=>{if(s.children[0].innerText===t){const i=s.children[1];e[t].forEach((e=>{i.append(this.createTask(e,t))}))}}))}},s=new class{constructor(e){this.gui=e,this.addTask=this.addTask.bind(this),this.addEvent=this.addEvent.bind(this),this.moveTask=this.moveTask.bind(this)}init(){this.gui.btn.addEventListener("click",(e=>this.addTask(e))),this.moveTask(this.gui.container),this.gui.tasksListFromLS();document.querySelectorAll(".items-item").forEach((e=>{this.addEvent(e)}))}addTask(e){e.preventDefault(),this.gui.input.classList.contains("hidden")?(this.gui.input.classList.remove("hidden"),this.gui.select.classList.remove("hidden")):0===this.gui.input.value.length?alert("Please, write title task"):0===this.gui.select.value.length?alert("Please, write status task"):(this.el=this.gui.createTask(this.gui.input.value,this.gui.select.value),this.gui.input.value="",this.gui.select.value="",this.addEvent(this.el),this.gui.input.classList.add("hidden"),this.gui.select.classList.add("hidden"),localStorage.dragNdrops=JSON.stringify(this.gui.getTasksListObjFromDom()))}addEvent(e){const t=e.querySelector(".close");e.addEventListener("mouseover",(()=>{t.classList.remove("hidden")})),e.addEventListener("mouseout",(()=>{t.classList.add("hidden")})),t.addEventListener("click",(()=>{t.parentElement.remove(),localStorage.dragNdrops=JSON.stringify(this.gui.getTasksListObjFromDom())}))}moveTask(t){let s=null,i=null,l=null,n=null,a=null;const c=document.createElement("li");c.classList.add("place"),c.classList.add("items-item"),t.addEventListener("mousedown",(t=>{t.preventDefault(),t.target.classList.contains("items-item")&&(l=t.clientX-t.target.getBoundingClientRect().left,n=t.clientY-t.target.getBoundingClientRect().top,s=t.target,a=e(t.clientX,t.clientY),i=t.target.cloneNode(!0),i.classList.add("dragged"),document.body.appendChild(i),i.style.left=t.pageX-l+"px",i.style.top=t.pageY-n+"px")})),t.addEventListener("mousemove",(t=>{t.preventDefault(),s&&(a=e(t.clientX,t.clientY),a.parent.insertBefore(c,a.child),i.style.left=t.pageX-l+"px",i.style.top=t.pageY-n+"px")})),t.addEventListener("mouseleave",(()=>{s&&(document.body.removeChild(i),i=null,s=null)})),t.addEventListener("mouseup",(()=>{s&&(a.parent.insertBefore(s,a.child),document.querySelector(".place")&&a.parent.removeChild(c),document.body.removeChild(i),localStorage.dragNdrops=JSON.stringify(this.gui.getTasksListObjFromDom()),i=null,s=null)}))}}(t);s.init()})();